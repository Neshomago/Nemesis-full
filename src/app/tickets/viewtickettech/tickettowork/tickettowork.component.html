
<ng-container *ngIf="theTicketData" style="z-index: 1;">
    <div style="background-color: whitesmoke; margin: 0;">
        <div class="forminmargin">
                <ng-template matStepLabel>Ticket general Information</ng-template>
                <mat-card class="example-card">
                      <mat-card-title>Created Ticket</mat-card-title>
                      <mat-card-subtitle >Date: {{theTicketData.creationDate}}</mat-card-subtitle>
                      <div style="border-left: 1px solid black; padding-left: 20px; border-left-style: dashed; padding-right: 20px;">
                          Ticket Status:
                          <div>
                              <div style="width: 90px;" [ngClass]="{'TicketResolved':theTicketData.status === 'RESOLVED', 'TicketAborted': theTicketData.status === 'ABORTED', 'TicketManaged': theTicketData.status === 'MANAGING', 'TicketOpened':theTicketData.status ==='OPENED' || 'WORKING'}">
                                <div style="display: flexbox; flex-flow: row; justify-self: center; text-align: center; align-self: center; padding-top: 5px;">
                                    {{theTicketData.status}}
                                </div>
                                </div>
                          </div>
                      </div>
                <mat-divider></mat-divider>
                    <mat-card-content>
                        <div>
                            <div>
                                <h2>Ticket Data
                                </h2>
                                <div color="primary" >
                                    <table>
                                        <tr>
                                            <td colspan="1" style="width: 150px;">Ticket ID</td>
                                            <td>:</td>
                                            <td colspan="1">{{theTicketData.id}}</td>
                                        </tr>
                                            <tr>
                                                <td colspan="1">Code</td>
                                                <td>:</td>
                                                <td colspan="1">{{theTicketData.code}}</td>
                                            </tr>
    
                                        <tr>
                                            <td colspan="1">Creation Date</td>
                                            <td>:</td>
                                            <td colspan="1">{{theTicketData.creationDate}}</td>
                                        </tr>
    
                                        <tr>
                                            <td colspan="1">Created by</td>
                                            <td>:</td>
                                            <td colspan="1">{{theTicketData.createdBy}}</td>
                                        </tr>
                                            <tr>
                                                <td colspan="1">Ticket type</td>
                                                <td >:</td>
                                                <td colspan="1">{{theTicketData.type}}</td>
                                            </tr>
                                            <tr>
                                                <td colspan="1">Priority</td>
                                                <td>:</td>
                                                <td colspan="1">{{theTicketData.priority}}</td>
                                            </tr>
                                    </table>
                                </div>
                            </div>
    
                        </div>
                        <mat-divider></mat-divider>
                        <div>
                            <h2>Agency Information</h2>
                                    <div>
                                        <table>
                                            <!-- Datos iniciales del ticket -->
                                                <tr>
                                                    <td colspan="1" style="width: 150px;">Agency Name</td>
                                                    <td>:</td>
                                                    <td colspan="1">{{theTicketData.name}}</td>
                                                </tr>
            
                                                <tr>
                                                    <td colspan="1">AAMS Code</td>
                                                    <td>:</td>
                                                    <td colspan="1">{{theTicketData.certification}}</td>
                                                </tr>
                                                
                                                
                                                <tr>
                                                <td colspan="1">Address</td>
                                                <td>:</td>
                                                <td colspan="1">{{theTicketData.address}}</td>
                                            </tr>
                                            
                                            <tr>
                                                <td colspan="1">Phone</td>
                                                <td>:</td>
                                                <td colspan="1">{{theTicketData.phone}}</td>
                                            </tr>
                                            
                                            <tr>
                                                <td colspan="1">Email</td>
                                                <td >:</td>
                                                <td colspan="1">{{theTicketData.email}}</td>
                                            </tr>
                                            <tr>
                                                <td colspan="1">Shop Code</td>
                                                <td>:</td>
                                                <td colspan="1">{{theTicketData.managerId}}</td>
                                            </tr>
                                        </table>
                                    </div>
                        </div>
                        <div style="border-top: 1px dotted gray;">
                            <div>
                                <h2>Additional Information:</h2>
                            </div>
                                <mat-list>
                                    <mat-list-item style="color: black;">{{theTicketData.description}}</mat-list-item>
                                </mat-list>
                        </div>
                    </mat-card-content>
                </mat-card>
                <ng-container style="padding-top: 20px;">
                    <mat-divider></mat-divider>
                </ng-container>

                <div>
                    <!-- <app-equipmententry></app-equipmententry> -->
                <mat-card class="full-width">
                        <div>
                                <h2>Equipment: 
                                </h2>
                        </div>
                        <div>
                            <table>
                                <tr style="border-bottom: 2px solid gray; height: 40px;">
                                    <th width="25%">
                                        Category
                                    </th>
                                    <th width="55%">
                                        Name
                                    </th>
                                    <th width="20%">
                                        Serial Number
                                    </th>
                                </tr>
                                <tr *ngFor="let tag of unserialTags" style="border-bottom: 0.5px solid rgb(192, 192, 192); height: 40px;">
                                    <td>
                                        <div>
                                            <div>•<span *ngFor="let category of categoryList">
                                                <span *ngIf="tag.item_description == category.id">{{category.category_name}}</span>
                                            </span></div>
                                        </div>
                                    </td>
                                    <td>{{tag.item}}</td>    
                                    <td>{{tag.item_serial}}</td>
                                </tr>
                            </table>
                        </div>
                        <br>
                    <!-- </div> -->
                    </mat-card>
                </div>
              <mat-card>
                  <mat-card-title>Technician Assigned:
                  </mat-card-title>
    
                    <div class="col-6">
                      <h2>Technician code: </h2>
                      <div>
                          <div>
                              {{theTicketData.tech_assign}}
                          </div>

                          &nbsp;
                      </div>
                      <mat-divider></mat-divider>
                      <h2>Date of visit: </h2>
                      <p>
                        {{theTicketData.assignedDate | date:'MMMM dd, yyyy'}}
                      </p>
                    </div>
                <!-- </div> -->
              </mat-card>
              <div style="height: 30px;"></div>
               <mat-card>
                <h2>Items from technical review:
                    <ng-container class="col-md-3 ms-md-auto">

                        <div class="col-auto">
                            <button mat-icon-button (click)="addItem(theTicketData.id)"><mat-icon>add</mat-icon></button>
                        </div>
                        <div class="col-md-3 ms-md-auto">
                            <ng-container *ngIf="tagsarray == []">
                                <button mat-icon-button><mat-icon>save</mat-icon>Confirm Items</button>
                            </ng-container>
                        </div>
                    </ng-container>
                </h2>

                <ng-container *ngIf="theTicketData.version == 5 || theTicketData.version == 7">
                        <div class="row" *ngFor="let obj of tagsarray; let i = index">
                            <div class="col-auto">
                                <button mat-icon-button (click)="addItem(theTicketData.id)">
                                <mat-icon>add</mat-icon>
                                </button>
                            </div>
                            <div class="col-auto">
                                <button mat-icon-button (click)="removeItem(i)">
                                <mat-icon>delete</mat-icon>
                                </button>
                            </div>

                            <!-- Item from agency -->
                            <div class="col">
                                <mat-form-field class="full-width">
                                <mat-label>Checked Item: </mat-label>
                                <mat-select matNativeControl name="item" [(ngModel)]="obj.item">
                                    <mat-option *ngFor="let tag of AgencyItems; let i = index" [value]="tag.name">
                                    {{i}}{{tag.name}} - {{tag.description}}
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>
                            </div>

                            <!--  -->
                            <div class="col" *ngIf="AgencyItems">
                                From destination: {{AgencyItems.locationId}}
                            </div>


                            <div class="col">
                                <mat-form-field class="full-width" >
                                    <mat-label>Send To</mat-label>
                                    <mat-select matNativeControl name="location" id="location" >
                                        <!-- [(ngModel)]="theTicketUpdate.agencyId" (ngModelChange)="agencyListBindUpdate()" -->
                                        <mat-option *ngFor="let warehouse of warehouses" [value]="warehouse.id">
                                        <!-- <ng-container>  -->
                                            {{warehouse.name}}
                                         <!-- </ng-container> -->
                                        </mat-option>
                                    <mat-option *ngFor="let Agency of AgencyListNames" [value]="Agency.id">{{Agency.name}}</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>

                            <div class="col">
                                <mat-form-field class="full-width">
                                    <mat-label>Condition</mat-label>
                                    <mat-select matInput name="condition" id="condition" ngModel="status">
                                        <mat-option value="OPERATIVE">OPERATIVE</mat-option>
                                        <mat-option value="BROKEN">BROKEN</mat-option>
                                        <mat-option value="WARRANTY">WARRANTY</mat-option>
                                        <mat-option value="LOST">LOST</mat-option>
                                        <mat-option value="PENDING">PENDING</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </div>
                </ng-container>
               </mat-card>


            <div style="height: 30px;"></div>
            <mat-card>
                <mat-card-title>Technical review notes:</mat-card-title>
                <ng-container *ngIf="theTicketData.version == 6">
                    <div>
                        {{theTicketData.assigned_tags}}
                    </div>
                    <mat-divider>
                    </mat-divider>
                    <div>
                        <div>
                            <h3>
                                Uploaded Pictures
                            </h3>
                        </div>
                        <div style="display: flex; flex-wrap: wrap;">
                            <div *ngIf="theTicketData.file1 != null && theTicketData.file1 != ''" style="display: flex; flex-direction: row; padding-right: 15px;">
                                <a href="http://localhost:5000/uploads/{{theTicketData.file1}}" target="_blank">
                                    <img src="http://localhost:5000/uploads/{{theTicketData.file1}}" style="height: 100px"/>
                                </a>
                            </div>
                            <div *ngIf="theTicketData.file2 != null && theTicketData.file2 != ''" style="display: flex; flex-direction: row; padding-right: 15px;">
                                <a href="http://localhost:5000/uploads/{{theTicketData.file2}}" target="_blank">
                                    <img src="http://localhost:5000/uploads/{{theTicketData.file2}}" style="height: 100px"/>
                                </a>
                            </div>
                            <div *ngIf="theTicketData.file3 != null && theTicketData.file3 != ''" style="display: flex; flex-direction: row; padding-right: 15px;">
                                <a href="http://localhost:5000/uploads/{{theTicketData.file3}}" target="_blank">
                                    <img src="http://localhost:5000/uploads/{{theTicketData.file3}}" style="height: 100px"/>
                                </a>
                            </div>
                            <div *ngIf="theTicketData.file4 != null && theTicketData.file4 != ''" style="display: flex; flex-direction: row; padding-right: 15px;">
                                <a href="http://localhost:5000/uploads/{{theTicketData.file4}}" target="_blank">
                                    <img src="http://localhost:5000/uploads/{{theTicketData.file4}}" style="height: 100px"/>
                                </a>
                            </div>
                            <div *ngIf="theTicketData.file5 != null  && theTicketData.file5 != ''" style="display: flex; flex-direction: row; padding-right: 15px;">
                                <a href="http://localhost:5000/uploads/{{theTicketData.file5}}" target="_blank">
                                    <img src="http://localhost:5000/uploads/{{theTicketData.file5}}" style="height: 100px"/>
                                </a>
                            </div>
                            <div *ngIf="theTicketData.file6 != null  && theTicketData.file6 != ''" style="display: flex; flex-direction: row; padding-right: 15px;">
                                <a href="http://localhost:5000/uploads/{{theTicketData.file6}}" target="_blank">
                                    <img src="http://localhost:5000/uploads/{{theTicketData.file6}}" style="height: 100px"/>
                                </a>
                            </div>
                            <div *ngIf="theTicketData.file7 != null  && theTicketData.file7 != ''" style="display: flex; flex-direction: row; padding-right: 15px;">
                                <a href="http://localhost:5000/uploads/{{theTicketData.file7}}" target="_blank">
                                    <img src="http://localhost:5000/uploads/{{theTicketData.file7}}" style="height: 100px"/>
                                </a>
                            </div>
                            <div *ngIf="theTicketData.file8 != null && theTicketData.file8 != ''" style="display: flex; flex-direction: row; padding-right: 15px;">
                                <a href="http://localhost:5000/uploads/{{theTicketData.file8}}" target="_blank">
                                    <img src="http://localhost:5000/uploads/{{theTicketData.file8}}" style="height: 100px"/>
                                </a>
                            </div>
                            <div *ngIf="theTicketData.file9 != null && theTicketData.file9 != ''" style="display: flex; flex-direction: row; padding-right: 15px;">
                                <a href="http://localhost:5000/uploads/{{theTicketData.file9}}" target="_blank">
                                    <img src="http://localhost:5000/uploads/{{theTicketData.file9}}" style="height: 100px"/>
                                </a>
                            </div>
                            <div *ngIf="theTicketData.file10 != null  && theTicketData.file10 != ''" style="display: flex; flex-direction: row; padding-right: 15px;">
                                <a href="http://localhost:5000/uploads/{{theTicketData.file10}}" target="_blank">
                                    <img src="http://localhost:5000/uploads/{{theTicketData.file10}}" style="height: 100px"/>
                                </a>
                            </div>
                            <div *ngIf="theTicketData.file11 != null && theTicketData.file11 != ''" style="display: flex; flex-direction: row; padding-right: 15px;">
                                <a href="http://localhost:5000/uploads/{{theTicketData.file11}}" target="_blank">
                                    <img src="http://localhost:5000/uploads/{{theTicketData.file11}}" style="height: 100px"/>
                                </a>
                            </div>
                            <div *ngIf="theTicketData.file12 != null && theTicketData.file12 != ''" style="display: flex; flex-direction: row; padding-right: 15px;">
                                <a href="http://localhost:5000/uploads/{{theTicketData.file12}}" target="_blank">
                                    <img src="http://localhost:5000/uploads/{{theTicketData.file12}}" style="height: 100px"/>
                                </a>
                            </div>
                        </div>
                    </div>
                </ng-container>
                


                <ng-container class="row" *ngIf="theTicketData.version == 5 || theTicketData.version == 7">
                    <mat-form-field class="col-12">
                        <mat-label>Write your observations: </mat-label>
                        <textarea matInput name="notes" id="notes" placeholder="Notes of the ticket work" [(ngModel)]="theResolvedTicketUpdate.assigned_tags">
                        </textarea>
                    </mat-form-field>
                   <!-- Opcion 1  -->
                    <div>
                        <label for="photos">
                            Upload your image(s): 
                        </label>
                        <input name="photos" type="file" (change)="uploadMultiple($event)" multiple/>
                            <div style="display: flex; flex-wrap: wrap;">
                                <div *ngFor="let ar of files" style="display: flex; flex-direction: row; padding-right: 15px;">
                                    <a href="http://localhost:5000/uploads/{{ar.name}}" target="_blank">
                                        <img src="http://localhost:5000/uploads/{{ar.name}}" style="height: 100px"/>
                                    </a>
                                    <button mat-mini-fab (click)="eliminafoto(ar)" style="transform: scale(0.7);">x</button>
                                </div>
                            </div>
                    </div>                    

                </ng-container>
            </mat-card>
            <div style="height: 30px;"></div>
            <!-- FOOTER BOTTOM SECTION -->
            <div class="container">
                <div class="row">
                    <div class="col">
                        <button  mat-raised-button  (click)="rptDownload()">DOWNLOAD REPORT</button>
                    </div>
                    <div class="col" *ngIf="theTicketData.version == 5 || theTicketData.version == 7">
                        <button mat-raised-button color="accent" #tooltip="matTooltip" matTooltip="Finalize Ticket Process" (click)="resolved(theTicketData.id); resolvedImagesroute(theTicketData.id)" [disabled]="theResolvedTicketUpdate.assigned_tags == '' || theResolvedTicketUpdate.assigned_tags == null">TICKET RESOLVED</button>
                    </div>  
                    <!-- <div class="col">
                        <button (click)="resolvedImagesroute(theTicketData.id)">Prueba names</button>
                    </div> -->
                    <div class="col" *ngIf="theTicketData.version == 5 || theTicketData.version == 7">
                        <button mat-raised-button color="warn" (click)="deleteTicket(theTicketData.id)">ABORT TICKET</button>
                    </div>
                </div>
            <div style="height: 20px;"></div>
        </div>
        </div>
    </div>
    
    <div style="position: fixed; right: 40px; bottom: 30px; display: inline-block;">
        <div>
            <button mat-fab color="accent" routerLink="/viewtickettech"
            #tooltip="matTooltip"
            matTooltip="Return to Ticket list"
            ><mat-icon>assignment_return</mat-icon></button>
        </div>
    </div>
</ng-container>
    
    
    <!-- SECCION DE PDF NO MOSTRADA -->
    <div class="rectanglecover">
    </div>    
    <div class="ddt" *ngIf="theTicketData">
        <div id="dataPdfReport">
        <!-- style="width: 95%; height: 100%; align-self: center; padding: 20px;" -->
    
            <table border="1">
                <!-- encabezado PDF -->
                <tr style="border-top: 3px solid gray;">
                    <td>
                        <img src="assets/img/logo-lumia-2.png" alt="Logo Lumia" height="100px">
                    </td>
                    <td style="font-size: 12px; line-height: 15px;" colspan="3">
                        Via Selva Di Sotto Snc, Località Cese <br>
                        San Salvatore Telesino -Telese- 82030 (BN) Italy <br>
                        Telefono: +39-0824-948243 <br>
                        Fax: +39-0824-948243 <br>
                        P.IVA / C.F. 03949540615 <br>
                        email: info@lumiasrl.com <br>
                    </td>
                    <td colspan="2">
                        <table width="450">
                            <tr>
                                <td style="text-align: right;">
                                    Installation Report: 
                                </td>
                                <td style="text-align: left; border: 1px solid;">
                                    {{theTicketData.tech_assign}} / 
                                </td>
                            </tr>
                            <tr>
                                <td style="text-align: right;">
                                    Installation: 
                                </td>
                                <td style="text-align: left; border: 1px solid;">
                                    {{theTicketData.userId}} - Ticket: {{theTicketData.id}}
                                </td>
                            </tr>
                        </table>
                    </td>
        </tr>
        <tr style="border-top: 3px solid gray; width: 95%;">
            <td style="padding-left: 20px;">
                <h2>
                    Client
                </h2>
            </td>
        </tr>
        <tr style="border-top: 1.5px solid gray; width: 95%;">
            <td colspan="4" style="padding-left: 40px;">
                <tr>
                    <td>
                        Agency Code: {{theTicketData.managerId}}
                    </td>
                </tr>
                <tr>
                    <td>
                        Fiscal Code: 
                    </td>
                </tr>
                <tr>
                    <td>
                        Certification: {{theTicketData.certification}}
                    </td>
                </tr>
                <tr>
                    <td>
                        Address: {{theTicketData.address}}
                    </td>
                </tr>
                <tr>
                    <td>
                        Phone: {{theTicketData.phone}}
                    </td>
                </tr>
                <tr *ngIf="theTicketData.email">
                    <td>
                        Email: {{theTicketData.email}}
                    </td>
                </tr>
                <tr>
                    <td>
                        IVA: 
                    </td>
                </tr>
            </td>
        </tr>
        <tr style="border-top: 3px solid gray; width: 95%;">
            <td style="padding-left: 20px;">
                <h2>
                    Intervento
                </h2>
            </td>
        </tr>
        <tr style="border-top: 1.5px solid gray; width: 95%;">
            <td colspan="6" style="padding-left: 40px;">
                <tr>
                    <td>
                        Date e hora di apertura:
                    </td>
                    <td>
                        {{theTicketData.creationDate}}
                    </td>
                </tr>
                <tr>
                    <td>
                        Date and time of intervention: 
                    </td>
                    <td>
    
                    </td>
                </tr>
                <tr>
                    <td>
                        Date and time finished intervention:
                    </td>
                    <td>
                        {{theTicketData.closedDate}}
                    </td>
                </tr>
            </td>
        </tr>
        <tr style="border-top: 3px solid silver; width: 95%;">
            <td  style="padding-left: 20px;" colspan="6">
                <h2>
                    REPORT: 
                </h2>
            </td>
        </tr>
        <tr>
            <td style="padding-left: 20px; text-align: center;" colspan="1">Operation</td>
            <td colspan="2" style="text-align: center;">Item</td>
            <td colspan="2" style="text-align: center;">Serial number</td>
            <td colspan="1" style="text-align: center;">Item Status</td>
        </tr>
        <tr *ngFor="let tag of unserialTags; let indice = index">
                <td colspan="1" style="text-align: center;">
                    {{theTicketData.type}}
                </td>
                <td style="padding-left: 20px; text-align: center;" colspan="2">
                        {{tag.item}}
                </td>
                <td colspan="2" style="text-align: center;">{{tag.item_serial}}</td>
                <td colspan="1" style="text-align: center;">OPERATIVE</td>
        </tr>
        <tr style="flex: 1; overflow: auto;"></tr>
        <tr>
            <td colspan="6" style="padding: 20px;">
                    <div class="d-flex">
                            <div class="flex-fill p-2 border border-1">
                                <span style="font-size: 12px; color: grey;">Technician name: </span><span style="font-weight: 500; color: black;"> {{theTicketData.tech_assign}}</span>
                                <br>
                                <br>
                                <span style="font-size: 12px; color: grey;">Technician Signature:________________________________</span>
                                <br>
                            </div>
                            <div class="flex-fill p-2 border border-1">
                                <span style="font-size: 12px; color: grey;">Timbro e firma del cliente</span>
                                <br>
                            </div>
                    </div>
            </td>
        </tr>
        <tr>
            <td colspan="6" style="font-size: 10px; line-height: 10px; text-align: center;">
                Documento Interno Amministrativo. Interventi tecnici presso clienti. Il materiale sopra descritto, fornito dal nostro tecnico nel suo intervento, è esonerato da
                DDT (DPR 627/78) ai sensi C.M. 5/360586 del 12/12/76
    
                <br>
                SCHEDAORDINE RAPPORTOINTERVENTO
                rev.2 del 17/12/2016
            </td>
        </tr>
    </table>
    </div>
    </div>