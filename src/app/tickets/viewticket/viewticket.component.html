
<div style="background-color: whitesmoke; margin: 0;">
    <div class="forminmargin">
        <mat-vertical-stepper [linear]="isLinear" #stepper>
            <!-- <div style="width: 90px;" [ngClass]="{'TicketResolved':theTicket.status === 'RESOLVED', 'TicketAborted': theTicket.status === 'ABORTED', 'TicketManaged': theTicket.status === 'MANAGING', 'TicketOpened':theTicket.status ==='OPENED'}"></div>
                        <mat-select name="" id="" [(value)]="theTicket.status">
                            <mat-option>NONE</mat-option>
                            <mat-option value="OPENED">OPENED</mat-option>
                            <mat-option value="MANAGING">MANAGING</mat-option>
                            <mat-option value="RESOLVED">RESOLVED</mat-option>
                            <mat-option value="ABORTED">ABORTED</mat-option>
                        </mat-select>   -->
        <mat-step [stepControl]="firstFormGroup">
            <ng-template matStepLabel>Ticket general Information</ng-template>
        <div *ngFor="let theTicket of theTicketData; let i = index" [class.active]="i == currentIndex">
            <mat-card class="example-card">
                <mat-card-header>
                  <mat-card-title>Created Ticket</mat-card-title>
                  <mat-card-subtitle >Date: {{theTicket.creationDate}}</mat-card-subtitle>
                  <div style="border-left: 1px solid black; padding-left: 20px; border-left-style: dashed; border-right: 1px solid black; padding-right: 20px; border-right-style: dashed;">
                      Ticket Status:
                      <div>
                          <div style="width: 90px;" [ngClass]="{'TicketResolved':theTicket.status === 'RESOLVED', 'TicketAborted': theTicket.status === 'ABORTED', 'TicketManaged': theTicket.status === 'MANAGING', 'TicketOpened':theTicket.status ==='OPENED'}">
                            <div>
                                {{theTicket.status}}
                            </div>
                              <!-- <span style="display: flex; width: 100px; align-content: center;">{{theTicket.status}}</span> -->
                            </div>
                      </div>
                  </div>
                </mat-card-header>
            <mat-divider></mat-divider>
                <mat-card-content>
                    <div>
                        <div>
                            <h2>Ticket Data
                                <button mat-icon-button *ngIf="!showEdit" (click)="toogleEdit()" style="color:orange;">
                                    <mat-icon style="font-size: 18px;">edit</mat-icon> Edit
                                </button>
                                <button mat-icon-button *ngIf="showEdit" (click)="toogleEdit()" style="color:orange;">
                                    <mat-icon style="font-size: 18px;">west</mat-icon>
                                </button>
                            </h2>
                            <div color="primary" >
                                <table>
                                    <tr>
                                        <td colspan="1" style="width: 150px;">Ticket ID</td>
                                        <td>:</td>
                                        <td colspan="1">{{theTicket.id}}</td>
                                    </tr>

                                    <tr>
                                        <td colspan="1">Code</td>
                                        <td>:</td>
                                        <td colspan="1">{{theTicket.code}}</td>
                                    </tr>

                                    <tr>
                                        <td colspan="1">Creation Date</td>
                                        <td>:</td>
                                        <td colspan="1">{{theTicket.creationDate}}</td>
                                    </tr>

                                    <tr>
                                        <td colspan="1">Created by</td>
                                        <td>:</td>
                                        <td colspan="1">{{theTicket.createdBy}}</td>
                                    </tr>

                                    <div *ngIf="!showEdit">
                                        <tr>
                                            <td colspan="1">Ticket type</td>
                                            <td >:</td>
                                            <td colspan="1">{{theTicket.type}}</td>
                                        </tr>
                                        <tr>
                                            <td colspan="1">Priority</td>
                                            <td>:</td>
                                            <td colspan="1">{{theTicket.priority}}</td>
                                        </tr>
                                    </div>
                                    <div *ngIf="showEdit">
                                        <tr>
                                            <td colspan="1">Ticket type</td>
                                            <td >:</td>
                                            <td>
                                                <mat-form-field>
                                                    <mat-label>Request Type:</mat-label>
                                                    <mat-select matNativeControl id="type" name="type" [(ngModel)]="theTicket.type">
                                                      <mat-option value="INS">INSTALATION</mat-option>
                                                      <mat-option value="INT">INTEGRATION</mat-option>
                                                      <mat-option value="MAN">MAINTENANCE</mat-option>
                                                      <mat-option value="DIS">UNINSTALL</mat-option>
                                                      <mat-option value="SUP">SUPPORT</mat-option>
                                                      <mat-option value="IND">INTEGRATION DELIVERY</mat-option>
                                                      <mat-option value="MND">MAINTENANCE DELIVERY</mat-option>
                                                    </mat-select>
                                                  </mat-form-field>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="1">Priority</td>
                                            <td>:</td>
                                            <td>
                                                <mat-form-field>
                                                    <mat-label>Priority:</mat-label>
                                                    <mat-select matNativeControl name="priority" id="priority" [(ngModel)]="theTicket.priority">
                                                      <mat-option value="LOW">Low Priority</mat-option>
                                                      <mat-option value="NORMAL">Normal</mat-option>
                                                      <mat-option value="HIGH">High Priority</mat-option>
                                                    </mat-select>
                                                  </mat-form-field>
                                            </td>
                                        </tr>
                                    </div>
                                </table>
                            </div>
                        </div>

                    </div>
                    <mat-divider></mat-divider>
                    <div>
                        <h2>Agency Information</h2>
                                <div>
                                    <table>
                                        <tr>
                                            <td colspan="1" style="width: 150px;">Agency Name</td>
                                            <td>:</td>
                                            <td colspan="1">{{theTicket.id}} | {{theTicket.name}}</td>
                                        </tr>
    
                                        <tr>
                                            <td colspan="1">AAMS Code</td>
                                            <td>:</td>
                                            <td colspan="1">{{theTicket.certification}}</td>
                                        </tr>
    
                                        <tr>
                                            <td colspan="1">Address</td>
                                            <td>:</td>
                                            <td colspan="1">{{theTicket.address}}</td>
                                        </tr>
    
                                        <tr>
                                            <td colspan="1">Phone</td>
                                            <td>:</td>
                                            <td colspan="1">{{theTicket.phone}}</td>
                                        </tr>
    
                                        <tr>
                                            <td colspan="1">Email</td>
                                            <td >:</td>
                                            <td colspan="1">{{theTicket.email}}</td>
                                        </tr>
                                        <tr>
                                            <td colspan="1">Shop Code</td>
                                            <td>:</td>
                                            <td colspan="1">{{theTicket.managerId}}</td>
                                        </tr>
                                    </table>
                                </div>
                    </div>
                    <div style="border-top: 1px dotted gray;">
                        <div>
                            <h2>Additional Information:
                                <!--
                                <button mat-icon-button *ngIf="showEdit" (click)="toogleEdit()">
                                    <mat-icon>save-alt</mat-icon>
                                </button> -->
                            </h2>
                        </div>
                        <div>
                            <ng-container class="full-width">
                                <mat-list>
                                    <mat-list-item style="color: black;" *ngIf="!showEdit" (ngModel)="theTicket.description">{{theTicket.description}}</mat-list-item>
                                    <!-- <mat-list-item style="color: black;" *ngIf="!showEdit" (ngModel)="theTicket.description">{{theTicket.description}}</mat-list-item> -->
                                </mat-list>
                                <input matInput type="text" name="description" id="description" *ngIf="showEdit" [(ngModel)]="theTicket.description" value="{{theTicket.description}}" autofocus />
                            </ng-container>
                        </div>

                    </div>
                </mat-card-content>
            </mat-card>
            <ng-container style="padding-top: 20px;">
                <mat-divider></mat-divider>
            </ng-container>
        </div>
        </mat-step>

        <!-- PASO 2 -->
        <mat-step [stepControl]="secondFormGroup">
            <ng-template matStepLabel>Aditional Equipment to select</ng-template>
        <div>
            <!-- <additionalequipment></additionalequipment> -->

                <mat-card class="full-width">
                    <div class="row">
                        <div class="col">
                            <mat-card-title>Adittional Equipment: </mat-card-title>
                        </div>
                        <div class="col-auto">
                            <button mat-icon-button (click)="addItem()"><mat-icon>add</mat-icon></button>
                        </div>
                        <div class="col-md-3 ms-md-auto">
                            <button mat-icon-button (click)="saveEquipment()"><mat-icon>save</mat-icon>Save changes</button>
                        </div>
                    </div>
                    <form formGroup="allestimento">
                        <div>
                            <div>
                                <div>
                                    <input type="text" formControlName="item"/>
                                    <div class="col-auto">
                                        <button mat-icon-button (click)="addItem()"><mat-icon>add</mat-icon></button>
                                    </div>
                                    <div class="col-auto">
                                        <button  mat-icon-button (click)="removeItem()"><mat-icon>delete</mat-icon></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
            
                    <div class="container">
                        <div>
                            <div> 
                                <div class="row" *ngFor="let obj of tagsarray; let i = index" >
                                    <div class="col-auto">
                                        <button mat-icon-button (click)="addItem()"><mat-icon>add</mat-icon></button>
                                    </div>
                                    <div class="col-auto">
                                        <button  mat-icon-button (click)="removeItem(i)"><mat-icon>delete</mat-icon></button>
                                    </div>
                                    <!-- <div class="col-auto">
                                        <mat-form-field class="full-width">
                                            <mat-select matNativeControl id="selection" name="selection">
                                                <mat-option value="name">By Name</mat-option>
                                                <mat-option value="tag">By Tag</mat-option>
                                            </mat-select>
                                        </mat-form-field>
                                    </div> -->
                                    
                                    <!-- <div class="col-3">
                                        <mat-form-field class="full-width">
                                            <mat-label>Qty.</mat-label>
                                            <input matInput type="number" name="quantity{{i}}" [(ngModel)]="additionals.quantity" value=1/>
                                        </mat-form-field>
                                    </div> -->
                                    <div class="col-auto">
                                        <mat-form-field class="full-width">
                                            <mat-select matNativeControl name="item{{i}}">
                                                <mat-option *ngFor="let tag of newtags" [value]="tag.name"> {{tag.name}}</mat-option>
                                            </mat-select>
                                        </mat-form-field>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>  
            </mat-card>

        </div>
        </mat-step>

        <!-- PASO 3 -->
        <mat-step [stepControl]="thirdFormGroup">
            <ng-template matStepLabel>Serialization of Equipment</ng-template>
        <div>
            <!-- <app-equipmententry></app-equipmententry> -->
            <mat-card class="full-width">
                <div class="row">
                    <div class="col">
                        <mat-card-title>Equipment Serialization: </mat-card-title>
                    </div>
                    <!-- <div class="col-auto">
                        <button mat-icon-button (click)="addItem()"><mat-icon>add</mat-icon></button>
                    </div> -->
                    <div class="col-md-3 ms-md-auto">
                        <button mat-icon-button (click)="saveSerials()"><mat-icon>save</mat-icon>Save changes</button>
                    </div>
                </div>
                    <div class="row">
                        <div *ngFor="let obj of tagsarray; let i = index" >
                            <div *ngFor="let tag of unserialTags" >
                                <button  mat-icon-button (click)="removeItem(i)"><mat-icon>delete</mat-icon></button>
                                    <mat-form-field class="col-3">
                                        <input matInput matInput type="text" name="item{{i}}" [(ngModel)]="tag.item" disabled/>
                                    </mat-form-field>
                                    &nbsp;
                                    <mat-form-field class="col-6">
                                        <mat-label>Serial Number</mat-label>
                                        <input matInput type="text" name="serial{{i}}" [(ngModel)]="tag.item_serial"/>
                                    </mat-form-field>

                            </div>
                        </div>
                    </div>    
            </mat-card>
        </div>
        </mat-step>

        <!-- PASO 4 -->
        <mat-step [stepControl]="fourthFormGroup">
            <ng-template matStepLabel>Technician Assigned</ng-template>
            <mat-card>
                <mat-card-title>Techinician Asigned: </mat-card-title>
                <div class="container">
                    <form>

                        <mat-form-field class="col-6">
                            <mat-label>Technicians</mat-label>
                            <mat-select matNativeControl name="priority" id="priority">
                                <mat-option>None</mat-option>
                                <mat-option>Option Technician 2</mat-option>
                                <mat-option *ngFor="let tech of TechnicianList" [value]="tech.username">
                                    <div style="line-height: 12px; font-weight: 400;">{{tech.id}} - {{tech.username}} | 
                                            <span *ngIf="tech.IsAvailable === 1" style="color: green; font-weight: 500;"><span class="material-icons" style="font-size: 12px;">
                                                event_available
                                            </span>Available</span>
                                            <span *ngIf="tech.IsAvailable === 0" style="color: gray;"><span class="material-icons" style="font-size: 12px;">
                                                event_busy
                                            </span>Not Available</span>
                                        </div>
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                            &nbsp;
                            <mat-form-field class="col-3">
                                <mat-label>Choose a date</mat-label>
                                <input matInput [matDatepicker]="picker">
                                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                                <mat-datepicker #picker></mat-datepicker>
                            </mat-form-field>
                            
                            <div class="col">                  
                                <button mat-raised-button>Date visit</button>
                            </div>
                        </form>
                    </div>
            </mat-card>
            <ng-template>

            </ng-template>
            </mat-step>
    </mat-vertical-stepper>
    <div style="height: 20px;"></div>
    <div class="container">
        <div class="row">
            <button mat-raised-button>CREATE DDT</button>
        </div>
        <div style="height: 20px;"></div>
        <div class="row">
            <button mat-raised-button>ABORT TICKET</button>
        </div>
    </div>
    </div>
</div>

<div style="position: fixed; right: 40px; bottom: 30px; display: inline-block;">
    <!-- <div style="padding-bottom: 20px;">
        <button mat-fab (click)="setCurrentTicket(theTicketData.id)" [routerLink]="['/edit-ticket/',theTicketData.id]"><mat-icon>edit-row</mat-icon></button>
    </div> -->
    <div style="padding-bottom: 20px;">
        <button mat-fab (click)="updateTicket()"
        #tooltip="matTooltip"
          matTooltip="Save changes"
        ><mat-icon>save</mat-icon></button>
        <!-- [routerLink]="['/edit-ticket/',theTicketData.id] -->
    </div>
    <div>
        <button mat-fab color="warn" routerLink="/create-ticket"
        #tooltip="matTooltip"
        matTooltip="Return to List without changes"
        ><mat-icon>close</mat-icon></button>
    </div>
</div>